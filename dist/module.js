!function(){var util,sh,path,os,fs,child_process,insp,obtain,isSameStr,hasIn,isSolidArray,isSolidString,srrd,NETSH_EXE,exec,execSync,net,MODULE_TITLE,throwErrNonStr;Wsh&&Wsh.Net||(Wsh.Net={},util=Wsh.Util,sh=Wsh.Shell,path=Wsh.Path,os=Wsh.OS,fs=Wsh.FileSystem,child_process=Wsh.ChildProcess,insp=util.inspect,obtain=util.obtainPropVal,isSameStr=util.isSameMeaning,hasIn=util.hasIn,isSolidArray=util.isSolidArray,isSolidString=util.isSolidString,srrd=os.surroundCmdArg,NETSH_EXE=os.exefiles.netsh,exec=child_process.exec,execSync=child_process.execSync,net=Wsh.Net,MODULE_TITLE="WshNet/Net.js",throwErrNonStr=function(functionName,typeErrVal){util.throwTypeError("string",MODULE_TITLE,functionName,typeErrVal)},net.respondsHost=function(host){isSolidString(host)||throwErrNonStr("net.respondsHost",host);host=execSync(os.exefiles.ping+" "+host);return!!/(time|時間 )[=<]\d+ms/.test(host.stdout)},net.showIpConfigAll=function(options){options=obtain(options,"winStyle","activeDef");exec("ipconfig /all",{closes:!1,winStyle:options})},net.getAdaptersPropsSWbemObjs=function(macAddress,options){var query="SELECT * FROM Win32_NetworkAdapter WHERE PhysicalAdapter = True",macAddress=(isSolidString(macAddress)&&"*"!==macAddress?query+=' AND MACAddress = "'+macAddress+'"':(isSolidString(macAddress)||(query+=" AND NOT MACAddress = null"),obtain(options,"excludesVirtual",!0)&&(query+=' AND NOT Description LIKE "%virtual%"'),obtain(options,"excludesWireless",!1)&&(query+=' AND NOT Description LIKE "%wireless%"')),os.WMI.execQuery(query));return null===obtain(options,"isConnecting",null)?macAddress:macAddress.filter(function(sWbemObjSet){try{return 0<=sWbemObjSet.NetConnectionStatus&&sWbemObjSet.NetConnectionStatus<=3}catch(e){return!1}})},net.getAdaptersPropsObjs=function(macAddress,options){macAddress=net.getAdaptersPropsSWbemObjs(macAddress,options);return os.WMI.toJsObjects(macAddress)},net.enablesDHCP=function(macAddress,options){isSolidString(macAddress)||throwErrNonStr("net.enablesDHCP",macAddress);macAddress=net.getAdaptersPropsObjs(macAddress,options),options=os.WMI.toJsObjects(macAddress);if(!isSolidArray(options))return!1;macAddress=options[0].GUID;return 1===sh.RegRead("HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\services\\Tcpip\\Parameters\\Interfaces\\"+macAddress+"\\EnableDHCP")},net.getAdaptersConfsSWbemObjs=function(macAddress,options){var query='SELECT * FROM Win32_NetworkAdapterConfiguration WHERE NOT Description LIKE "RAS Async Adapter"';return isSolidString(macAddress)&&"*"!==macAddress?query+=' AND MACAddress = "'+macAddress+'"':query+=" AND NOT MACAddress = null",obtain(options,"excludesVirtual",!0)&&(query+=' AND NOT Description LIKE "%virtual%"'),obtain(options,"excludesWireless",!1)&&(query+=' AND NOT Description LIKE "%wireless%"'),os.WMI.execQuery(query)},net.getAdaptersConfsObjs=function(macAddress,options){macAddress=net.getAdaptersConfsSWbemObjs(macAddress,options);return os.WMI.toJsObjects(macAddress)},net.getIpSetInAdapters=function(macAddress,options){var macAddress=net.getAdaptersConfsObjs(macAddress,options),macAddress=os.WMI.toJsObjects(macAddress),options=obtain(options,"ipVer","IPv4"),iIpVer=isSameStr(options,"IPv6")?1:0,rtnIPs=[];return macAddress.forEach(function(adapter){hasIn(adapter,"IPAddress")&&null!==adapter.IPAddress&&rtnIPs.push(adapter.IPAddress[iIpVer].toString())}),rtnIPs},net.getDefaultGateways=function(macAddress,options){var macAddress=net.getAdaptersConfsObjs(macAddress,options),options=os.WMI.toJsObjects(macAddress),rtnIPs=[];return options.forEach(function(adapter){hasIn(adapter,"DefaultIPGateway")&&null!==adapter.DefaultIPGateway&&rtnIPs.push(adapter.DefaultIPGateway.toString())}),rtnIPs},net.getDnsIPsSetInAdapters=function(macAddress,options){macAddress=net.getAdaptersPropsObjs(macAddress,options);if(!isSolidArray(macAddress))return[];options=macAddress[0].GUID;return sh.RegRead("HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\services\\Tcpip\\Parameters\\Interfaces\\"+options+"\\NameServer").split(",")},net.exportWinFirewallSettings=function(destPath,options){isSolidString(destPath)||throwErrNonStr("net.exportWinFirewallSettings",destPath);var destPath=path.resolve(destPath),destPath=srrd(NETSH_EXE)+" advfirewall export "+srrd(destPath),runsAdmin=obtain(options,"runsAdmin",!0),options=obtain(options,"isDryRun",!1);return execSync(destPath,{runsAdmin:runsAdmin,winStyle:"hidden",isDryRun:options})},net.setIpAddress=function(netName,ip,mask,defGw,options){isSolidString(netName)||throwErrNonStr("net.setIpAddress",netName);netName='interface ipv4 set address name="'+netName+'"',isSolidString(ip)?(netName+=" source=static address="+ip,isSolidString(mask)?netName+=" mask="+mask:netName+=" mask=255.255.255.0",isSolidString(defGw)&&(netName+=" gateway="+defGw+" gwmetric=1")):netName+=" source=dhcp",ip=srrd(NETSH_EXE)+" "+netName,mask=obtain(options,"runsAdmin",null),defGw=obtain(options,"isDryRun",!1);return execSync(ip,{runsAdmin:mask,winStyle:"hidden",isDryRun:defGw})},net.setIpAddressesWithWMI=function(netName,ip,mask,defGw){var FN="net.setIpAddressesWithWMI",netName="SELECT * FROM Win32_NetworkAdapterConfiguration WHERE Index = "+(netName=isSolidString(netName)?netName:net.getAdaptersPropsObjs()[0].NetConnectionID),wmiObjs=os.WMI.execQuery(netName);if(0===wmiObjs.length)throw new Error("Error [EmptyWMI Object Return]\n  at "+FN+" ("+MODULE_TITLE+")\n  query: "+insp(netName));if(wmiObjs[0].DHCPEnabled?console.log(FN+": already DCHP."):rtnCode=wmiObjs[0].EnableDHCP(),!isSolidString(ip))return isSolidString(defGw)&&(rtnCode=wmiObjs[0].SetGateways([defGw])),!0;var netName=isSolidString(mask)?mask:"255.255.255.0",rtnCode=wmiObjs[0].EnableStatic([ip],[netName]);if(0===rtnCode)return isSolidString(defGw)&&(rtnCode=wmiObjs[0].SetGateways([defGw])),!0;if(1===rtnCode)return console.log(FN+":\n  Successful completion, reboot required."),isSolidString(defGw)&&(rtnCode=wmiObjs[0].SetGateways([defGw])),!0;if(-66===rtnCode)throw new Error("Error [Invalid SubnetMask]\n  at "+FN+" ("+MODULE_TITLE+")\n  newMask: "+insp(netName));if(-2147180508===rtnCode)throw new Error("Error [WindowOfNetConfig]\n  at "+FN+" ("+MODULE_TITLE+")\n  ネットワーク設定画面を閉じて再試行してください。");throw new Error("Error [Not Code 0]\n  at "+FN+" ("+MODULE_TITLE+")\n  rtnCode: "+rtnCode)},net.setDnsServers=function(netName,dns1,dns2,options){var FN="net.setDnsServers",argsStr1=(isSolidString(netName)||throwErrNonStr(FN,netName),'interface ipv4 set dnsservers name="'+netName+'"'),dns1=(isSolidString(dns1)?argsStr1+=" source=static address="+dns1+" register=non validate=no":argsStr1+=" source=dhcp",srrd(NETSH_EXE)+" "+argsStr1),runsAdmin=obtain(options,"runsAdmin",null),options=obtain(options,"isDryRun",!1),dns1=execSync(dns1,{runsAdmin:runsAdmin,winStyle:"hidden",isDryRun:options});if(!options&&dns1.error)throw new Error("Error: [StdErrNotEmpty]\n  at "+FN+" ("+MODULE_TITLE+')\n  exefile: "'+NETSH_EXE+'"\n  args: '+insp(argsStr1)+"\n  rtnVal: "+insp(dns1));if(!isSolidString(dns2))return options?"dry-run ["+FN+"]: "+dns1:void 0;argsStr1='interface ipv4 add dnsservers name="'+netName+'" address='+dns2+" index=2 validate=no",netName=srrd(NETSH_EXE)+" "+argsStr1,dns2=execSync(netName,{runsAdmin:runsAdmin,winStyle:"hidden",isDryRun:options});if(options)return"dry-run ["+FN+"]: "+dns1+"\n"+dns2;if(dns2.error)throw new Error("Error: [StdErrNotEmpty]\n  at "+FN+" ("+MODULE_TITLE+')\n  exefile: "'+NETSH_EXE+'"\n  args: '+insp(argsStr1)+"\n  rtnVal: "+insp(dns2))},net.setDnsServersWithWMI=function(netadpIndex,dnsAdds){var FN="net.setDnsServersWithWMI",netadpIndex="SELECT * FROM Win32_NetworkAdapterConfiguration WHERE IPEnabled = True AND Index = "+netadpIndex,wmiObjs=os.WMI.execQuery(netadpIndex);if(0===wmiObjs.length)throw new Error("Error [EmptyWMI Object Return]\n  at "+FN+" ("+MODULE_TITLE+")\n  query: "+insp(netadpIndex));netadpIndex=wmiObjs[0].SetDNSServerSearchOrder(dnsAdds);if(0===netadpIndex)return!0;if(1===netadpIndex)return console.log(FN+":\n  Successful completion, reboot required."),!0;if(-2147180508===netadpIndex)throw new Error("Error [WindowOfNetConfig]\n  at "+FN+" ("+MODULE_TITLE+")\n  ネットワーク設定画面を閉じて再試行してください。");throw new Error("Error [Failed to set SetDNSServerSearchOrder]\n  at "+FN+" ("+MODULE_TITLE+")\n  rtnCode: "+insp(netadpIndex))},net.importWinFirewallSettings=function(srcPath,options){var FN="net.importWinFirewallSettings",srcPath=(isSolidString(srcPath)||throwErrNonStr(FN,srcPath),path.resolve(srcPath)),FN=(fs.statSync(srcPath).isFile()||fs.throwTypeErrorNonExisting(MODULE_TITLE,FN,srcPath),"advfirewall import "+srrd(srcPath)),srcPath=srrd(NETSH_EXE)+" "+FN,FN=obtain(options,"runsAdmin",!0),options=obtain(options,"isDryRun",!1);return execSync(srcPath,{runsAdmin:FN,winStyle:"hidden",isDryRun:options})})}();
!function(){var util,os,fs,child_process,net,insp,obtain,isSolidArray,isSolidString,isSameMeaning,NET,srrd,exec,execSync,throwErrNonStr;Wsh&&Wsh.Net.SMB||(Wsh.Net.SMB={},util=Wsh.Util,os=Wsh.OS,fs=Wsh.FileSystem,child_process=Wsh.ChildProcess,net=Wsh.Net,insp=util.inspect,obtain=util.obtainPropVal,isSolidArray=util.isSolidArray,isSolidString=util.isSolidString,isSameMeaning=util.isSameMeaning,NET=os.exefiles.net,srrd=os.surroundCmdArg,exec=child_process.exec,execSync=child_process.execSync,throwErrNonStr=function(functionName,typeErrVal){util.throwTypeError("string","WshNet/SMB.js",functionName,typeErrVal)},net.SMB.IPC="IPC$",net.SMB.shareDirectory=function(shareName,dirPath,options){var FN="net.SMB.shareDirectory",FN=(isSolidString(shareName)||throwErrNonStr(FN,shareName),isSolidString(dirPath)||throwErrNonStr(FN,dirPath),fs.statSync(dirPath).isDirectory()||fs.throwTypeErrorNonExisting("WshNet/SMB.js",FN,dirPath),"share "+srrd(shareName)+"="+srrd(dirPath)),shareName=obtain(options,"userName","Everyone"),dirPath=obtain(options,"grant","READ"),shareName=(isSolidString(shareName)&&isSolidString(dirPath)&&(FN+=" /GRANT:"+shareName+","+dirPath),obtain(options,"remark","")),dirPath=(isSolidString(shareName)&&(FN+=" /REMARK:"+srrd(shareName)),srrd(NET)+" "+FN),shareName=obtain(options,"runsAdmin",!0),FN=obtain(options,"isDryRun",!1);return execSync(dirPath,{runsAdmin:shareName,winStyle:"hidden",isDryRun:FN})},net.SMB.showLocalShares=function(options){var options=obtain(options,"winStyle","activeDef"),command=srrd(NET)+" share";exec(command,{closes:!1,winStyle:options})},net.SMB.getLocalSharesSWbemObjs=function(){return os.WMI.execQuery("SELECT * FROM Win32_Share")},net.SMB.getLocalSharesObjs=function(){var sWbemObjSets=net.SMB.getLocalSharesSWbemObjs();return os.WMI.toJsObjects(sWbemObjSets)},net.SMB.existsShareName=function(shareName){return isSolidString(shareName)||throwErrNonStr("net.SMB.existsShareName",shareName),net.SMB.getLocalSharesObjs().some(function(shareObj){return isSameMeaning(shareObj.Name,shareName)})},net.SMB.delSharedDirectory=function(shareName,options){isSolidString(shareName)||throwErrNonStr("net.SMB.delSharedDirectory",shareName);var shareName="share "+srrd(shareName)+" /DELETE /YES",shareName=srrd(NET)+" "+shareName,runsAdmin=obtain(options,"runsAdmin",!0),options=obtain(options,"isDryRun",!1);return execSync(shareName,{runsAdmin:runsAdmin,winStyle:"hidden",isDryRun:options})},net.SMB._getNetUseArgsStrToConnect=function(comp,shareName,domain,user,pwd){isSolidString(comp)||throwErrNonStr("net.SMB._getNetUseArgsStrToConnect",comp);var argsStr="use";return isSolidString(shareName)?argsStr+=" "+srrd("\\\\"+comp+"\\"+shareName):argsStr+=" "+srrd("\\\\"+comp+"\\"+net.SMB.IPC),isSolidString(pwd)&&(argsStr+=" "+srrd(os.escapeForCmd(pwd))),isSolidString(user)&&(isSolidString(domain)?argsStr+=" /user:"+domain+"\\"+user:argsStr+=" /user:"+user),argsStr+=" /persistent:no"},net.SMB.connect=function(comp,shareName,domain,user,pwd,options){comp=net.SMB._getNetUseArgsStrToConnect(comp,shareName,domain,user,pwd),shareName=srrd(NET)+" "+comp,domain=obtain(options,"runsAdmin",null),user=obtain(options,"isDryRun",!1);return exec(shareName,{runsAdmin:domain,winStyle:"hidden",isDryRun:user})},net.SMB.connectSync=function(comp,shareName,domain,user,pwd,options){comp=net.SMB._getNetUseArgsStrToConnect(comp,shareName,domain,user,pwd),shareName=srrd(NET)+" "+comp,domain=obtain(options,"runsAdmin",null),user=obtain(options,"isDryRun",!1);return execSync(shareName,{runsAdmin:domain,winStyle:"hidden",isDryRun:user})},net.SMB.showCurrentSession=function(options){var options=obtain(options,"winStyle","activeDef"),command=srrd(NET)+" use";exec(command,{closes:!1,winStyle:options})},net.SMB.getActiveConnectionsSwbemObjs=function(matched){var sWbemObjSets=os.WMI.execQuery("SELECT * FROM Win32_NetworkConnection");if(!isSolidString(matched))return sWbemObjSets;var matchedRE=new RegExp(matched,"i");return sWbemObjSets.filter(function(sWbemObjSet){return matchedRE.test(sWbemObjSet.Name)})},net.SMB.getActiveConnectionsObjs=function(matched){matched=net.SMB.getActiveConnectionsSwbemObjs(matched);return os.WMI.toJsObjects(matched)},net.SMB.hasConnection=function(connectionName){isSolidString(connectionName)||throwErrNonStr("net.SMB.hasConnection",connectionName);var connections=net.SMB.getActiveConnectionsObjs();return!!isSolidArray(connections)&&connections.some(function(connection){return connection.Name===connectionName&&/^(OK|Degraded)$/i.test(connection.Status)})},net.SMB._getNetUseArgsStrToDisconnect=function(comp,shareName){var argsStr="use";return isSolidString(comp)?isSolidString(shareName)?argsStr+=" "+srrd("\\\\"+comp+"\\"+shareName):argsStr+=" "+srrd("\\\\"+comp):argsStr+=" *",argsStr=argsStr+" /delete"+" /yes"},net.SMB.disconnect=function(comp,shareName,options){comp=net.SMB._getNetUseArgsStrToDisconnect(comp,shareName),shareName=srrd(NET)+" "+comp,comp=obtain(options,"runsAdmin",null),options=obtain(options,"isDryRun",!1);return exec(shareName,{runsAdmin:comp,winStyle:"hidden",isDryRun:options})},net.SMB.disconnectSync=function(comp,shareName,options){comp=net.SMB._getNetUseArgsStrToDisconnect(comp,shareName),shareName=srrd(NET)+" "+comp,comp=obtain(options,"runsAdmin",null),options=obtain(options,"isDryRun",!1),shareName=execSync(shareName,{runsAdmin:comp,winStyle:"hidden",isDryRun:options});return options?"dry-run [net.SMB.disconnectSync]: "+shareName:(/NET HELPMSG 2250/i.test(shareName.stderr)&&(shareName.error=!1),shareName)},net.SMB.connectSyncSurely=function(comp,shareName,domain,user,pwd,options){var FN="net.SMB.connectSyncSurely",remotePath=(isSolidString(comp)||throwErrNonStr(FN,comp),"\\\\"+comp);if(isSolidString(shareName)?remotePath+="\\"+shareName:remotePath+="\\"+net.SMB.IPC,!net.SMB.hasConnection(remotePath)){var remotePath=obtain(options,"isDryRun",!1),retLog="",retVal=net.SMB.disconnectSync(comp,shareName,options);if(remotePath&&(retLog="dry-run ["+FN+"]: "+retVal),retVal=net.SMB.connectSync(comp,shareName,domain,user,pwd,options),remotePath)return retLog+"\n"+retVal;if(retVal.error&&(!/1219/.test(retVal.stderr)||!net.SMB.disconnectSync(comp,shareName)||(retVal=net.SMB.connectSync(comp,shareName,domain,user,pwd)).error))throw new Error("Error [ExitCode Not 0]\n  at "+FN+" (WshNet/SMB.js)\n  comp: "+comp+"\n  shareName: "+shareName+"\n  domain: "+domain+"\n  user: "+user+"\n  retVal: "+insp(retVal))}})}();
